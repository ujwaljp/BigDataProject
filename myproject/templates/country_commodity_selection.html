{% extends "base.html" %}
<!-- {% load plotly_dash %} -->

{% block content %}
<style>
    .form-container {
        display: flex;
        align-items: center;
        margin-top: 20px;
    }

    .year-dropdown {
        margin-right: 10px;
    }

    .submit-btn {
        margin-left: 10px;
    }

    .chart-container {
        margin-top: 20px;
    }

    .chart {
        width: 100%;
    }
    .commodity-dropdown{
        width : 500px;
    }
</style>

<h1>Country Trade Analysis by Commodity</h1>

<!-- Form container for country and commodity selection -->
<div class="form-container">
    <!-- Country selection dropdown menu -->
    <label for="country-dropdown">Select Country:</label>
    <select id="country-dropdown" name="country">
        {% for country in country_values %}
        {% if selected_country == country %}
        <option value="{{ country }}" selected>{{ country }}</option>
        {% else %}
        <option value="{{ country }}">{{ country }}</option>
        {% endif %}
        {% endfor %}
    </select>

    <!-- Commodity selection dropdown menu -->
    <label for="commodity-dropdown">Select Commodity:</label>
    <select id="commodity-dropdown" name="commodity" class="commodity-dropdown">
        {% for commodity in commodity_values %}
        {% if selected_commodity == commodity %}
        <option value="{{ commodity }}" selected>{{ commodity }}</option>
        {% else %}
        <option value="{{ commodity }}">{{ commodity }}</option>
        {% endif %}
        {% endfor %}
    </select>

    <!-- Start year dropdown menu -->
    <label for="start-year" class="year-dropdown">Start Year:</label>
    <select id="start-year" name="start_year" class="year-dropdown">
        {% for year in year_values %}
        <option value="{{ year }}" {% if year == selected_start_year %}selected{% endif %}>{{ year }}</option>
        {% endfor %}
    </select>

    <!-- End year dropdown menu -->
    <label for="end-year" class="year-dropdown">End Year:</label>
    <select id="end-year" name="end_year" class="year-dropdown">
        {% for year in year_values %}
        <option value="{{ year }}" {% if year == selected_end_year %}selected{% endif %}>{{ year }}</option>
        {% endfor %}
    </select>

    <!-- Submit button -->
    <button type="button" id="submit-btn" class="submit-btn">Submit</button>
</div>

<!-- Chart container -->
<div class="chart-container">
    <!-- Render the chart -->
    <div id="chart" class="chart">
        {{ bar_chart_html | safe }}
    </div>
</div>

<script>
    // Event listener for submit button
    document.getElementById('submit-btn').addEventListener('click', function (event) {
        var selectedCountry = document.getElementById('country-dropdown').value;
        var selectedCommodity = document.getElementById('commodity-dropdown').value;
        var selectedStartYear = document.getElementById('start-year').value;
        var selectedEndYear = document.getElementById('end-year').value;

        // Redirect with selected parameters
        var url = '/dashboard/country_selection/?';
        url += 'country=' + encodeURIComponent(selectedCountry);
        url += '&commodity=' + encodeURIComponent(selectedCommodity);
        url += '&start_year=' + encodeURIComponent(selectedStartYear);
        url += '&end_year=' + encodeURIComponent(selectedEndYear);
        window.location.href = url;
    });
</script>

{% endblock content %}
